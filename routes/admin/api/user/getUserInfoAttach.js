/**
 * Created by elenahao on 15/10/14.
 */

'use strict'

'use strict';
var path = require('path');
var Q = require('q');
var Lazy = require('lazy.js');
var _ = require('lodash');
var request = require('request');
var http = require('http');
var redis = require(path.resolve(global.gpath.app.libs + '/redis'));
var mysql = require(path.resolve(global.gpath.app.libs + '/mysql'));
var Token = require(path.resolve(global.gpath.app.model + '/common/token'));
var User = require(path.resolve(global.gpath.app.model + '/common/user'));

// 调取微信接口获取用户的详细信息
app.get('/admin/api/getInfo/user_attach', function(req, res) {
    console.log("admin userInfo get...");
    var ACCESS_TOKEN = '';
    Token.getAccessToken().then(function resolve(res) {
        if(res.access_token){
            console.log(res.access_token);
            ACCESS_TOKEN = res.access_token;
            //从redis获取所有用户openid scan 每次获取100
            scan(ACCESS_TOKEN);
        }
    },function reject(err){
        res.status(400).send(JSON.stringify({
            ret: -4,
            msg: err
        }));
    })
});

function scan(ACCESS_TOKEN) {
    var dfd = Q.defer();
    function _scan(ACCESS_TOKEN){
        var body = '{"user_info_list":[{"subscribe":0,"openid":"o0aT-d-gqvFm4Weu88UCLK3FSSwE","unionid":"owJ__t9owQC-0nytn-Tr4A3JSVhI"},{"subscribe":0,"openid":"o0aT-d-gRIbmBOV4qMTp1RzIa1Xs","unionid":"owJ__tzNmBbCI4rYmrXbHdlVvMMQ"},{"subscribe":0,"openid":"o0aT-d-GT6RhSWdUdsJDkDyiVUE0","unionid":"owJ__t-UpgbjCqeB1fHuxk3AhUKA"},{"subscribe":0,"openid":"o0aT-d-gTfcM2etUgb-0efALrn2k","unionid":"owJ__t6-4eBQXGf1nOJbNNpdnjw8"},{"subscribe":0,"openid":"o0aT-d-gtIrnuO89X94H1majWXsw","unionid":"owJ__t1Wz6o6lvYLf6wjfwBL9-24"},{"subscribe":0,"openid":"o0aT-d-gtMw5wBRg4z7DqX6AUhP8","unionid":"owJ__t_bEAKxBOblJYNcmAGpNA5M"},{"subscribe":0,"openid":"o0aT-d-gTouBrOaQBB6XphmmrWxQ","unionid":"owJ__t4dAxO2fbx96Uww8h6u-GrM"},{"subscribe":1,"openid":"o0aT-d-gTTqboK-3RnDK5cPwGzOE","nickname":"JONI玥","sex":2,"language":"en","city":"东城","province":"北京","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/n9UUU8c5lXZSEwcETXkLWwia0BwxXUbVhwMZnCsjYia5OSOAClDXS0k0iaZKeuSG5UuXYCibfm8wLXfflQ9IreFSWTjBySjMMmB8\\/0","subscribe_time":1430528973,"unionid":"owJ__tzi14FRpGaiLbqQDNqxoU70","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-GTTr4sJ6YFFnO1Baxk5II","nickname":"琴","sex":2,"language":"zh_CN","city":"中山","province":"广东","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/n9UUU8c5lXYDLLqe6a6957lNrqyvedmqe1O552WgOy35u1vxgKFAJOibgicd1qDbqt8woq7Wf9pgXwcFsBwToglibhxCBMnricfC\\/0","subscribe_time":1438253805,"unionid":"owJ__t7e6g-NiO1u6tWa6P3RqSV8","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-gtttHyjJ199IhjXJvRasY","nickname":"赵强","sex":1,"language":"zh_CN","city":"杭州","province":"浙江","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/8h9QXaJ70ibekEJdFKicov5me5jNByyuQhmzxKb18wfyniczzb0jrErzOEuic05UqPaBKjbllyGh9NjMmxWCVCHGTd0QmUKAQNiba\\/0","subscribe_time":1444109632,"unionid":"owJ__tx5XEXuxnrtwCqaxZjZrK-k","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-GtTVA3QfjgsIoGlPOGmvk","nickname":"漫步","sex":1,"language":"zh_CN","city":"虹口","province":"上海","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/QibVAgDXN70GgiaE6W1SVATJj8uyicvZhLzgIUGgUKZR6Am7EQ1669E8ov2mWtSkjJSia0czqNf6pIKkNxyTXoPWLheTLkLTeCsb\\/0","subscribe_time":1443421426,"unionid":"owJ__tw-maSIWLUWYO6jdjXX0CnA","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-GttWtUVgZVfHH6kqvjX7I","nickname":"  宇婷婷婷","sex":2,"language":"zh_CN","city":"延边","province":"吉林","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/QibVAgDXN70GgiaE6W1SVATIfibNFiaGmnzeX0jkTHvcqv5GhygiaWpZ6hBkhicsibOmgzuUcUb71dp59icNDN2icLNsCR5A81dFrPanX\\/0","subscribe_time":1436939330,"unionid":"owJ__t6eo9YsKI2OKmBtK4aCX9zE","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-GTtxBBTt4nOhtR_fVKhIw","nickname":"零碎゛記忆oas","sex":0,"language":"zh_CN","city":"","province":"","country":"","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/8h9QXaJ70ibekEJdFKicov5hZ6qP9DxAveUS8KSgXNUDwicD7bibJ4zK43PpqCVSUKBNxibvZvOicpvD9oXLvtCMavNWJVzkZOJicRw\\/0","subscribe_time":1440077783,"unionid":"owJ__twKNzO6P_PrF5UMlyf6sUQw","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-gTTxcxZTOrGxCR-XfB98k","nickname":"清●硕","sex":0,"language":"zh_CN","city":"","province":"","country":"","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/ajNVdqHZLLBicXgSpeHV0VHeDz6rk8C1f5rbz8H1s3CuuYiaECiaX0GrPoHZNHuuIib6ZsF4iaiaEtdNYFgavgVGMrKa2f3Kcs2WPOktHdCe3HuUg\\/0","subscribe_time":1440828156,"unionid":"owJ__t96j3KfJ4fQx8bj_FN4y3n8","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-gTTxjOEydm1nCR1tl0q5Y","nickname":"段敬业","sex":1,"language":"zh_CN","city":"成都","province":"四川","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/ht2LicibT22O1ex377sDfqwrruXeF8WsI1DzqMSjyibLcgBpqUzicObC2bNiaD4ibGJKUlFBDlo6ZMEiaRf6pt2COraF16PNRMVbTC9\\/0","subscribe_time":1436790936,"unionid":"owJ__t5fRM6ef6RNI_u1MUikBauc","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-gtTylznksP-ZM3HUBJ028","nickname":"自由","sex":2,"language":"zh_CN","city":"","province":"奥法利","country":"爱尔兰","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/Q3auHgzwzM677iaFfmrbvUOupYbqdgrz5WNNFXqGwtlq8gHPmmG1FGukiatju3T1Qykxy2ttaGkEibKFbDE71mh516ppiaohoR3tZ0g28SYEmiak\\/0","subscribe_time":1441715243,"unionid":"owJ__t2kZ1PCzrM1oPK7KHK9yJAA","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-gtTZwZPmrefr5IFiDbNdc","nickname":"江珊","sex":2,"language":"zh_CN","city":"杭州","province":"浙江","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/QibVAgDXN70GgiaE6W1SVATOUCRxJia80xZmWibJA5LMe8572aoaKM6yevVyYutyKGO5lDeZlIYNhqNicqZYoUjGOp1QquNEBf6ja\\/0","subscribe_time":1422151347,"unionid":"owJ__t_Wt3dD5YafwG0udabwRVao","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-gTtzY3IvykVxm5HgPgRDA","nickname":"*Yuan*","sex":1,"language":"zh_CN","city":"N","province":"^N","country":"","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/n9UUU8c5lXZSEwcETXkLW11ArIg0q8engZb40lAAIzVcu3wk5xpSCxp013bnzzsFdvibL8XO2yN67rVw6Vh8Jmc9VCVAuZtSD\\/0","subscribe_time":1404999736,"unionid":"owJ__t2acmUmsT875Ea7SYjKAXNE","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-gttzz9YmxDumVGVW8onEA","nickname":"","sex":2,"language":"zh_CN","city":"阿德莱德","province":"南澳大利亚","country":"澳大利亚","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/ht2LicibT22O1B8fGS1BXCImZYLl3znBSwINAIt17GSppALXTLc9xcdGeqvNE6VEUw8KjDPY6o8YaakrUpXqVNcngnk4zriabRZ\\/0","subscribe_time":1443238922,"unionid":"owJ__t2XU8rxfngsd_uJIF9EW1F4","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-GtU03wc0sBg2dJK8lFTb4","nickname":"Jolinbaby哟","sex":1,"language":"zh_HK","city":"韶关","province":"广东","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/QibVAgDXN70GgiaE6W1SVATMrv8v1DNEjjLCXjysAR9xI9iaXb5LqnofKItficttzu3oJh8p6dC5ibib4o36QNHPGtiad7E9M10DZG4\\/0","subscribe_time":1444118187,"unionid":"owJ__t0Yd6FRuFEyTF22clZn3R3g","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-Gtu0gT2aDmA8MKrRjn_dA","nickname":"伪你 ﹌一个人迁就","sex":1,"language":"zh_CN","city":"武汉","province":"湖北","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/8qiaZwdPWRImylUKZ3UeIxGa3EENaIGrbwLQSyGmp8gbJPgPdEKUeOYQP5l6QLcbibu8kCibeWX2QgVweuhtpibRubFgicv26vuxR\\/0","subscribe_time":1437885246,"unionid":"owJ__t4NMKXZdyJ2QJCzL0No8dr8","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-GTu6SY8hXGbFfjMX39R2s","nickname":"小小","sex":2,"language":"zh_CN","city":"三明","province":"福建","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/ajNVdqHZLLAhOKkRxfAvtw7CToaIDfayg6DQWrPQaENbZNEiaZkiazMTMLSFqd217TNVmAQQtEuRicvria2WzhRrYw\\/0","subscribe_time":1428572790,"unionid":"owJ__t1UAdm_3hTgRePUVs0DD3YQ","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-gTu6vHvLyoqxBy_CaWPPo","nickname":"风过无痕","sex":0,"language":"zh_CN","city":"","province":"","country":"","headimgurl":"","subscribe_time":1424287523,"unionid":"owJ__t8HckgIqrkJ9iiDp2cIL2v0","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-gtU76UJxf1LmYd-xEQBP8","nickname":"...","sex":2,"language":"zh_CN","city":"咸阳","province":"陕西","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/QibVAgDXN70GgiaE6W1SVATL0bghMyvTbfJ5xN62GS0N7xBia32yS2yhzlLXUZUTlOunS3dyf3n1gCMy6s2dH9ht91DdE4CVia5b\\/0","subscribe_time":1436521690,"unionid":"owJ__t56OprscxEHVdD2g1Ip6z5I","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-gtu845uWZ4Tr9ViPKus70","nickname":"刘天-Tim","sex":1,"language":"zh_CN","city":"清远","province":"广东","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/QibVAgDXN70HVyvAomf9icXATJHauVGO6YHjO4ic9XwSYCJbNLaadicprcO3CTj96YO94ibYr4JrYxJu7SWfur2NOyfq1icibp7susU\\/0","subscribe_time":1428643460,"unionid":"owJ__t6Ip7_CFPpTiAIuXM9tFTUY","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-GtU9DsQxKW6Obl52l5QbQ","nickname":"破暖轻风","sex":1,"language":"zh_CN","city":"滁州","province":"安徽","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/n9UUU8c5lXac8P7dtgmDfaOwzYb7qK84Mr8tmrq5pmRMjHZB6ueDibmIHPZbUvywPy68LmHfibPrQvSIU2sMDOX7WjJwZf0HHB\\/0","subscribe_time":1431831246,"unionid":"owJ__t-K98MkRGc1COGqisYnyYJ8","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-gtuc-PGMVbTC7tqyIslvY","nickname":"蔡美好","sex":1,"language":"zh_CN","city":"","province":"广东","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/ht2LicibT22O3YJk6MlApCzRZGTubjdda5H18nexZ4elhDhao5LiaV64pB1bBVnJo3pDJrRYV1OfrGLA5mZVGVjwksrdaNLGCl5\\/0","subscribe_time":1444135511,"unionid":"owJ__t38-xdrH43xv-z-XLKYbdvY","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-gTuccLd8Cj21YS6AJTxJg","nickname":"甜甜圈的宠爱","sex":2,"language":"zh_CN","city":"上饶","province":"江西","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/ht2LicibT22O2iafOnjHCxJnJ5Hwy2cHwv9twknh6anWoiapQD2DVAa2XEwB6cTSkmPFbzZSjoldadks0JDm4gnPiclnqqnic0zoqo\\/0","subscribe_time":1443944845,"unionid":"owJ__t0ZX9ufVDq3nTfjWbVzOa1U","remark":"","groupid":0},{"subscribe":0,"openid":"o0aT-d-GtXqx6P03qfIjwXWUa_jg","unionid":"owJ__t_8Bl3yX3mNFHMtmjFAldy0"},{"subscribe":1,"openid":"o0aT-d-gU0irs71KGijiaZUR61wY","nickname":"兜兜转转","sex":1,"language":"zh_CN","city":"汉中","province":"陕西","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/PiajxSqBRaEKKxJtydJULS5ia9kWDdpv4STwjhN2sa6ZgZgMCjGvKCUxAnGWSmfbgZPm4tiaMIC6WRaORqLqQS4Qg\\/0","subscribe_time":1424287142,"unionid":"owJ__t9I73e2iC0OEnJ-saL337b4","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-gU0JOIA24LOOhIJaiNrcs","nickname":"潘建平","sex":1,"language":"zh_CN","city":"温州","province":"浙江","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/Q3auHgzwzM71DAxeCIThnZfnvfgZDrsoicl4ms6mK7j33aRr9Txb7abTUMq3fytesXCMicHjyrMiaFoV9coO6Mxfg\\/0","subscribe_time":1444195260,"unionid":"owJ__t8LS_bju9J7C1YdzQjMOF98","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-Gu0sac56Q_Hq6SFyVapXs","nickname":"ʚ欣ɞ","sex":2,"language":"zh_CN","city":"墨尔本","province":"维多利亚","country":"澳大利亚","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/QibVAgDXN70GgiaE6W1SVATAEW4E4LTrJNflpL6CTasYTdeSaXuGcvuszWpwKWibTOibkds6kYbOGhssTey6rRaiaoWsnvwqknctT\\/0","subscribe_time":1429222187,"unionid":"owJ__t46Dy06Zx-PNjOH6aAkBiVg","remark":"","groupid":0},{"subscribe":0,"openid":"o0aT-d-gUPgohROhUFO9CxLya3v8","unionid":"owJ__t7C7DNqOqMUF0x0yvr4XV7Y"},{"subscribe":0,"openid":"o0aT-d-GuYGIBmOPT4aE8_HC4I54","unionid":"owJ__t3shS2IPD9p_eynnATTS0EI"},{"subscribe":0,"openid":"o0aT-d-gvJWeHzUYpx1c5h2PE32c","unionid":"owJ__t5XTZSO9Z2pMYQKQMSsuHi0"},{"subscribe":0,"openid":"o0aT-d-gVsbBXapODkb8D_sHqp44","unionid":"owJ__t0lBbDToglcMIrC9BznRZ1c"},{"subscribe":0,"openid":"o0aT-d-gvwmBSfsxPt9ehZZ_jYEU","unionid":"owJ__tyzyF4NcEcNcFe5pg0_IRAg"},{"subscribe":0,"openid":"o0aT-d-gVxLF0kLTRLuvKs7QQICQ","unionid":"owJ__t_UP97R8NBaUNKFLOA_p3GI"},{"subscribe":0,"openid":"o0aT-d-GVyBofSGtE5brEWQdZ35g","unionid":"owJ__t8qgfI8TONHwHGjCsajPZxE"},{"subscribe":0,"openid":"o0aT-d-Gw8xWSf8xxWHku7DkxD6M","unionid":"owJ__tx12qXQ46XEhmPsTcDX1T4M"},{"subscribe":0,"openid":"o0aT-d-gwbjUgFzWb7Zl64qCZmCU","unionid":"owJ__t-UErPlDCRYCkb8PRnp3fEQ"},{"subscribe":0,"openid":"o0aT-d-GwKvup6-0bpxflBXE1Yx0","unionid":"owJ__t0xR4q4dr0KRWMENS-UG6kc"},{"subscribe":0,"openid":"o0aT-d-gwwKciukhH0nEBnhBA7Mw","unionid":"owJ__t8WlpNB5Cn98lIKiL2XfBdw"},{"subscribe":0,"openid":"o0aT-d-gwWZs5X5wv2Xcj-p8XHSA","unionid":"owJ__t_KQMJWyC4KCoss-y-TOj0A"},{"subscribe":0,"openid":"o0aT-d-GXB2xZxA8rMAg0skreZPI","unionid":"owJ__t7AYM0GqdfHhzJ1nQnb6npE"},{"subscribe":0,"openid":"o0aT-d-gXyB5KlRw55-XiXLgOsII","unionid":"owJ__t6sN_0cNhsBCPhg6nmHoYX8"},{"subscribe":0,"openid":"o0aT-d-GyBy1etfofh993XylAmEA","unionid":"owJ__t8OAfHLH6rrjjoEUqT9JbsA"},{"subscribe":0,"openid":"o0aT-d-gz56T91ZglKrRVKeb5m9A","unionid":"owJ__tzpr5XgNs5gUowgXQnfiVU0"},{"subscribe":0,"openid":"o0aT-d-GZNx0iSfHmn8uSET0mqcM","unionid":"owJ__twOw0xoN6D4sURJb9pJgVhk"},{"subscribe":0,"openid":"o0aT-d-G_bF8WyMaFhd70DHCIIVc","unionid":"owJ__t29_WZkSd6um_n7eLdb36_M"},{"subscribe":0,"openid":"o0aT-d-G_fWb76yC4LUur2I9YL2U","unionid":"owJ__tyhvsRy9WdoWP_eaJbPmyUM"},{"subscribe":0,"openid":"o0aT-d-h0hzaBWxewlxdBr6FW-NI","unionid":"owJ__tyqv6RQGVicVm5pFvF3lnJc"},{"subscribe":0,"openid":"o0aT-d-h0WdyzakZC9BCStri4P0I","unionid":"owJ__ty3g1HM0pdbTb3IWuOCrw70"},{"subscribe":0,"openid":"o0aT-d-H1Az5vxPqIT1MyqqZV1LY","unionid":"owJ__t7rZGVGjEO5yFWzjPhSYHz4"},{"subscribe":0,"openid":"o0aT-d-H20099l7-961teSxl8AJU","unionid":"owJ__tw_tGjxqX6J5E0GPJ1gcsPM"},{"subscribe":0,"openid":"o0aT-d-h2EBlrRrVI7AGMuRsrMk0","unionid":"owJ__t7xru_c0McEKw6S3-V3tqz4"},{"subscribe":0,"openid":"o0aT-d-h2gGB9af-hUeXuofoN-aw","unionid":"owJ__tx8osWoUUj03bamFvkwJYIw"},{"subscribe":1,"openid":"o0aT-d-h30H422qJnxJM_-WeNGhI","nickname":"命运\\n","sex":0,"language":"zh_CN","city":"沧州","province":"河北","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/8h9QXaJ70ibfQWNyZ4obl2QNjh3CkibIs5CWQyNRyYfA6dUDfQNFCA79RDXAnXDaYZ0PVIGiafpaicXhT6BibibWbLUqUkz4wKgEUP\\/0","subscribe_time":1417419259,"unionid":"owJ__t1z6TvzGEMls2e07LwnCfk8","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-H30s5AeSEzogye4UP9Rpw","nickname":"麦子米","sex":2,"language":"zh_CN","city":"南昌","province":"江西","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/ht2LicibT22O3kWzcabGPL0ABZSGG6JNeKbNkbt9wd9YSXTLtbdqn3SibgDaGiao1N8k5G83AbVDkuSwJN1D4zZ8I2Sakjjjuw3h\\/0","subscribe_time":1437467312,"unionid":"owJ__t4iVM1wZhrnHCz3xukUya1w","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-h311f43Oe4HCSc7W9odQ4","nickname":"SweetieM","sex":2,"language":"en","city":"广州","province":"广东","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/ht2LicibT22O1B8fGS1BXCIoZMiaMIsvCsOvMybaZDdzK3doe8T7MMPKLDz6lpzWEOYicEfnDHqLnhVYVgooW63xlXW2rjXoFvDb\\/0","subscribe_time":1438520408,"unionid":"owJ__t1dKo3mfzR2q8fb7aCTC88s","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-H314WYisWpKRi2-c9Xums","nickname":"何以温白。","sex":2,"language":"zh_CN","city":"南昌","province":"江西","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/8h9QXaJ70ibfbPDKF0bIPvLxnkyIfhFjqCUkib03VaicNy5Vib9aInOaFicOuhB2oibZAbjWJ7WZo9wAY0hLQpgXJSPw\\/0","subscribe_time":1442728429,"unionid":"owJ__tz7xvCgj2-pXxBcMO1Io2YI","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-h31FVZy1lsKvaAs_qrt2w","nickname":"阎佑","sex":1,"language":"zh_CN","city":"青岛","province":"山东","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/z5Oib2WYkI0Q5cT08EaTz3Flt2CrcmvbpbcX2ibfOBLcUxba8ibceicH0ZapTPIb1Ej3Ce70ib1bwpmicmvxP5rfnNLrscianNJG5Wx\\/0","subscribe_time":1418948316,"unionid":"owJ__t_QYMJglU2ysTo_R-IFZQh8","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-h31KjtVq-YRLOYVnlQF54","nickname":"。","sex":1,"language":"zh_CN","city":"南通","province":"江苏","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/ht2LicibT22O3kWzcabGPL0NNADP92m0R7yz9wp9R6iaSrZJPlfHY7eDbotdiclZ4VEQkAcJVU9GU3qicriaJRfYkNelPSE6rQbNtn\\/0","subscribe_time":1436673789,"unionid":"owJ__t5oPF1vpf4XJiv9yuUdqMks","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-H31MQRzptznaPI9Il0gBU","nickname":"▲","sex":1,"language":"zh_CN","city":"青岛","province":"山东","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/8h9QXaJ70ibekEJdFKicov5vTWJYXe1G3nHqt62yJrXgVWWpKDPcTEzkxWola3vrWQ0HQhYKQySJ2trqtUFOod1hBR6wsVwrML\\/0","subscribe_time":1437365384,"unionid":"owJ__t2RX6HicR23mF7rka8MrCi8","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-h31PQF4s4QFlW0I5nooRs","nickname":"空白得空白的空白","sex":1,"language":"zh_CN","city":"武汉","province":"湖北","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/Q3auHgzwzM5VrxLcnfYyOA3hQVyotuS0lqchicrTv9O15JrosUhX2vTxHfWQmNYFQlAyJtMc9TGgibZFAkS1FOXw\\/0","subscribe_time":1437452311,"unionid":"owJ__t_Zk8NKAXR-evm2OjaWqbXI","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-h31VJRGcOMFE6QDAnsLeY","nickname":"雨中哭泣","sex":2,"language":"zh_CN","city":"镇江","province":"江苏","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/8qiaZwdPWRImylUKZ3UeIxGLtz2ib6WhuR62tKQtSFpua9qkRmXfXLfakAe5XQXTxDDibpKz1al4Ob6Svb6ibU9KKgeajwGrzp3o\\/0","subscribe_time":1436509698,"unionid":"owJ__t6dDPg5jqeQOajzMazKGO0k","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-H31wK2rcMog2NpUIVT20g","nickname":"千里马","sex":1,"language":"zh_CN","city":"西城","province":"北京","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/ht2LicibT22O3kWzcabGPL0OLhtKwcRmlpsUIqt2kNFNLlQMAU26gqmZ7qicQfic8RCNxykrFRmPAEpL0ObD1kPRqUh1ITLlkHtf\\/0","subscribe_time":1391258970,"unionid":"owJ__t7E538gWjtACBCAzV7F4au8","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-h321FsChFjVvifbPh3fVI","nickname":"擎苍","sex":1,"language":"zh_CN","city":"沈阳","province":"辽宁","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/ajNVdqHZLLBfvrXGhcFW5eUe7kzsuWUNP4BbwhnFkvPPibfw7FaZvbE84P3waXcFZnfX1QUfFlSsdIiaPSvZAXJA\\/0","subscribe_time":1443267835,"unionid":"owJ__t_7ZK8ddeYxNeAnc9xUD9Ec","remark":"","groupid":0},{"subscribe":0,"openid":"o0aT-d-h5k6b_hkOXo9EoogdZ6Qo","unionid":"owJ__t9aOn3AFqLaD0o-BzhI78Vo"},{"subscribe":0,"openid":"o0aT-d-H6TUgB20tvDt9RdWYzXyA","unionid":"owJ__t3BJOqCAzlk_FcQkljEXZwE"},{"subscribe":1,"openid":"o0aT-d-H9sGcqtm9UuJSr1HSWgwk","nickname":"wcy","sex":1,"language":"zh_CN","city":"扬州","province":"江苏","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/Q3auHgzwzM5V0CuEEYyvZQQAwpDOibwFcrcH13eH11sC18WCsn6HtBmEeB7dibgfaVN0DbnCXuqZoEUpXTEibEAXKYXm4oH0wL3ib4qdPwSOZ9w\\/0","subscribe_time":1424287178,"unionid":"owJ__t5vx2IM2WhVfPq1yd-scDVI","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-H9SgHHfrK7U9aWTOc2nT8","nickname":"偶然～想念","sex":2,"language":"zh_CN","city":"","province":"","country":"尼泊尔","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/CiahAtM0x7azI2sktnDeCrRmqALia6ic5yibUgofB8eotr19qk6DaBFabtaRhcNJGFgGbWgUbK8GHUAqxrzLRu6jt32AyLyRkWWb\\/0","subscribe_time":1437228343,"unionid":"owJ__t2hWfk9_c8V-YVtzLOwa8QI","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-h9sioNXIHEqPt5ipdyBmg","nickname":"燕郊男科医院","sex":0,"language":"zh_CN","city":"","province":"","country":"","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/QibVAgDXN70FAKjmyPQ5CicM7JFdlGQqeibhEMg96OYPh4Af296rQTrq9QoD5NrOeVYRKyEoG2GU7YHiaVChibG5vPYayhtmts0DD\\/0","subscribe_time":1443496053,"unionid":"owJ__t_b5k3Tx3M4Vy-vYg61FnO0","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-h9sOorns5dAZZ9pe30rSw","nickname":" 577","sex":2,"language":"zh_CN","city":"泉州","province":"福建","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/ht2LicibT22O3kWzcabGPL0CBCwKPVjZIXewnw0OGbqSUaPGeGKWWar9wiatHicGiaf8d9AFJxc4pWTL1yjILN6qHDaSGuMvCRq3K\\/0","subscribe_time":1436496595,"unionid":"owJ__t1OJecGGHpuiYVI9NSXD_0g","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-H9sPCKecrzrjoithEg1wg","nickname":"迹兔戍39","sex":0,"language":"zh_CN","city":"","province":"","country":"","headimgurl":"","subscribe_time":1437113362,"unionid":"owJ__txb5c8P9xauQp4nFVvnr4Yc","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-H9SrcRklygH-aW5WBZGXo","nickname":"纪念日","sex":2,"language":"zh_CN","city":"宁波","province":"浙江","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/ajNVdqHZLLBicyLkHdLJs1xBh3ofTnApmKqlqr8laF173IPUSoib2U2ToQEx9yYibu9dSEicAvJHEaBVBubJ2MwVDA\\/0","subscribe_time":1441629811,"unionid":"owJ__txLfIqa2LFGFebhq6NwAUYg","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-h9sRdt1UfDp3JRvkV03gg","nickname":"失心","sex":1,"language":"zh_CN","city":"","province":"巴黎","country":"法国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/8h9QXaJ70ibeAJTeKRsu8ZsDibTibd025FPGGDuVx8Dldib6uO9Ow5enVAUey3sCEUia5nz6u2n9z9h4zxJzXfcOJtg\\/0","subscribe_time":1443182396,"unionid":"owJ__t18D5Hf22Md3w2jE_qRlWNc","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-H9SrkNQNOb9lSOHHmtFwc","nickname":"solar","sex":1,"language":"zh_CN","city":"大兴","province":"北京","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/QibVAgDXN70GgiaE6W1SVATO9BVedAZvZSM0nZGzwwPH5iaET9kqbvzSsgVymGzOPOTWjkveMiaqAiblrdw2T7bfyZezltl0egTov\\/0","subscribe_time":1424287265,"unionid":"owJ__tx28NAlFeUJpRYC-f9RDHXY","remark":"","groupid":0},{"subscribe":0,"openid":"o0aT-d-h9uk5b7N675X7TVoQuG2Q","unionid":"owJ__t5NqtTH6zC0HNAMUD3rEo-I"},{"subscribe":0,"openid":"o0aT-d-ha2ZU5xGDHGtTuv_tYppk","unionid":"owJ__txNvJGNGkSPv0apdQrdQgOI"},{"subscribe":0,"openid":"o0aT-d-HAD1i4-qNlLavIYjbcJrU","unionid":"owJ__t68U2rHgLLkkakpoy_OrxDk"},{"subscribe":0,"openid":"o0aT-d-HAj-rkg7TI1w5upIb18ks","unionid":"owJ__twOd1I-1oXqo9ymNWxazbP0"},{"subscribe":0,"openid":"o0aT-d-HAotDGdgpdebaSG_k6Osw","unionid":"owJ__t3y2F8ddeebNTvjKyV-0gdA"},{"subscribe":0,"openid":"o0aT-d-HAZe2IrCHT7CpuKdZoPLA","unionid":"owJ__t0duVjJHflJgMNcXV7hp8n8"},{"subscribe":1,"openid":"o0aT-d-hB5Ja03gEcJn8hhIvJ4JY","nickname":"小眼睛迷人","sex":0,"language":"zh_CN","city":"","province":"","country":"","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/n9UUU8c5lXZLx9NXMLcgcfsJ0uJ4lWkWShoQpRu3qLHnqLicJWHV1EibcmoibwMYJZWibLdHaZuO0jUtdta13Yz3lAdCV1jLcvc8\\/0","subscribe_time":1442066253,"unionid":"owJ__t-khrxpyEFf_yOa9CBHqtY4","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-Hb5k9treSBYsbJ7wdHbAk","nickname":"Action","sex":1,"language":"zh_CN","city":"朝阳","province":"北京","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/PiajxSqBRaEKAtJIQhdwzp6MSPnBoA81kGv1cNyaFJMQfxjkT7mbDTkzygCA29oXqb1ndx28gr8hibrUNm0YhqpIzt2aRaGQorCZiczVHneO3M\\/0","subscribe_time":1424287527,"unionid":"owJ__tyw6OdFzKblTH8bINHEDto4","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-Hb5lFU6fiIdHDqX0U1nng","nickname":"小民哥","sex":1,"language":"zh_CN","city":"长沙","province":"湖南","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/ht2LicibT22O37IOiby6xRbmickj3icdPb8EceRAcpt1CAPUricflSKtlteabatr8BIhTyRlDtRiaSSS1Rqe6rgFmkEtZ7cm1W6Y2Co\\/0","subscribe_time":1425444414,"unionid":"owJ__t-aeq6FcXEavbk4HMapGUCE","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-hb5lJ4awMnLdMO547RzYw","nickname":"脚踝和手的故事","sex":2,"language":"zh_CN","city":"","province":"","country":"安道尔","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/QibVAgDXN70GgiaE6W1SVATFxeFjJGAib7icFziaezVusE43CQCvH8SUODkaMZyABYLrPp5IoZSFzXB5kVwD00ic4weg2kldT73PMk\\/0","subscribe_time":1436748821,"unionid":"owJ__t2dSw_ugwnje5wev9Emkwp4","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-hB5otrfIzTOxDNwl48D4o","nickname":"Best 盛😜😖","sex":1,"language":"zh_CN","city":"广州","province":"广东","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/Q3auHgzwzM5V0CuEEYyvZQQAwpDOibwFcOwhr7sjEuQsUZwHMhXbs0ictaAzkNGKtJXUEFQ3Hxiasg1hSGmen51G4InFPSBcwP55J5sd0Oib32k\\/0","subscribe_time":1425220681,"unionid":"owJ__tzmVfNQKkhSNDQmsmAdJwAo","remark":"","groupid":0},{"subscribe":0,"openid":"o0aT-d-hBHUeijGv_H4K3P1YjlVY","unionid":"owJ__tyMPL5khm_ki_F5IfUu1CUU"},{"subscribe":1,"openid":"o0aT-d-hBny2kUGQUrcoYitcJ4F8","nickname":"","sex":1,"language":"zh_CN","city":"成都","province":"四川","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/PiajxSqBRaEJRcQDHuG46F54atvPfOl0ewRHyI587zxqzuW3k3Bw5BqQz19ZngJZZoVWZkzRDstuyxNIaQkNSPQ\\/0","subscribe_time":1437733695,"unionid":"owJ__t1ukUntb9HMLDh-JfQiC_Xo","remark":"","groupid":0},{"subscribe":0,"openid":"o0aT-d-HcT-tEJdXBtTUyCGQ2DGY","unionid":"owJ__tw89bopbbqDdZ6qidOhwl9g"},{"subscribe":0,"openid":"o0aT-d-HDOAR4r61Nj7i74-ZcZ9c","unionid":"owJ__t_EPO6pWQvEIJ7F6rUbBlTo"},{"subscribe":0,"openid":"o0aT-d-he3-4j-kXOMdkVgUNyXN4","unionid":"owJ__tzJKGvEI4f2L4sXoto_CB1w"},{"subscribe":0,"openid":"o0aT-d-HeEjaPevd0XxHgl5eYUpQ","unionid":"owJ__t33-kMArub3-LcgChpUDagA"},{"subscribe":1,"openid":"o0aT-d-heeRfXSZEQDYLrNdPKjH8","nickname":"胡勇","sex":1,"language":"zh_CN","city":"武汉","province":"湖北","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/ht2LicibT22O3kWzcabGPL0JJ85BzcjkXiaHNuH3wazicFe6jRMuYxA25ibiaWlEcn2nYAE5mgdicAQDMMJFZBicicKT1UL83uWVhrNQn\\/0","subscribe_time":1444024768,"unionid":"owJ__t5FQ5-D0xhrhSzXsgv9Gk0Y","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-HeErZzj52O4N0cADEj0aw","nickname":"小lemon向前跑","sex":2,"language":"zh_CN","city":"沈阳","province":"辽宁","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/PiajxSqBRaELk6I56oMyjRMvJxO8bhW0Cu9CB4sZ97GOp2OVXpOclt8ic7yBDuNYEKx6dY02IYeboD7f71OPRI5g\\/0","subscribe_time":1436519749,"unionid":"owJ__t-z6tYZwDpfP4o8LSQnX0pA","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-HEeScvJZ3YYQWRs0eR0-0","nickname":"迎光展颜","sex":2,"language":"zh_CN","city":"武汉","province":"湖北","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/PiajxSqBRaEJJC8diafUqlicaw31ic9pfpWIrqMlU7Adfhn2ib4ZeYOzrBelLErMcJT02iaLEek5ETLg8Vk4ehSViahhg\\/0","subscribe_time":1442656226,"unionid":"owJ__t5WDLjNihflFM5ceovj0PGo","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-heeSry2--UCImpBxVc6G8","nickname":"Jing","sex":2,"language":"zh_CN","city":"","province":"","country":"阿塞拜疆","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/QibVAgDXN70FznmxMGLfMJtasXD1m8WEP3vQCFukTpKrFLNW6c4wKrZrrW6baF5k9JIFdM0jmktIy8H94NqURBMYQ2nVRbgPM\\/0","subscribe_time":1443847993,"unionid":"owJ__t5zjmjay3nTqQ53UKjlRW2U","remark":"","groupid":0},{"subscribe":1,"openid":"o0aT-d-Heet5U_2mk8GDfg4C2gp4","nickname":"SHAN-CAROLYN","sex":2,"language":"zh_CN","city":"青岛","province":"山东","country":"中国","headimgurl":"http:\\/\\/wx.qlogo.cn\\/mmopen\\/3dZKCgGcAUd0dh921ReicRoHq5rKsvVNM09r2fTAqZ8w3bErJgV9uksvwdVZiaOTIM8wwJzwOH2kUkrDPqzye2YmjMpa9NO2pj\\/0","subscribe_time":1440500341,"unionid":"owJ__t8kJy0l5SlLbCN_Nhoo_FKQ","remark":"","groupid":0}]}';
        console.log(body);
        //存入redis
        try {
            var _body = JSON.parse(body);
            var user_info_list = _body.user_info_list;
            var users = [];
            for (var i = 0; i < user_info_list.length; i++) {
                var user = user_info_list[i];
                var temp = '';
                if (user && user.nickname) {
                    console.log(user.nickname);
                    temp = "(" + user.subscribe + ",'" + user.openid + "','" + user.nickname + "'," + user.sex + ",'" + user.language +
                        "','" + user.city + "','" + user.province + "','" + user.country + "','" + user.headimgurl + "'," + user.subscribe_time +
                        ",'" + user.unionid + "','" + user.remark + "'," + user.groupid + ")";
                    console.log('temp='+temp);
                    users.push(temp);
                }
            }
            Q.all(
                users
            ).then(function resolve(res) {
                    return mysql.user.updateUser(res.toString());
                }, function reject(err) {
                    dfd.reject(err);
                }).then(function resolve(res) {
                    console.log('is update ok:', res);
                }, function reject(err) {
                    dfd.reject(err);
                })
        } catch (err) {
            console.log(err);
        }
    }
    _scan(ACCESS_TOKEN);

    return dfd.promise;
}
